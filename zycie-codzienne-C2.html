<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>Test pamięci — Życie codzienne – C2</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; max-width:900px; margin:20px auto; padding:0 16px; line-height:1.45; }
  h1 { font-size:1.4rem; margin-bottom:0.2rem; }
  textarea { width:100%; min-height:120px; font-size:1rem; padding:10px; box-sizing:border-box; }
  button { padding:8px 12px; border-radius:8px; border:1px solid #bbb; background:white; cursor:pointer; margin-right:6px; }
  #results { margin-top:18px; }
  .good { background:#c6f6c6; }
  .bad { background:#fca5a5; }
  .muted { color:#555; font-size:0.95rem; }
  .counter { font-weight:bold; color:#2563eb; }
  table { border-collapse:collapse; width:100%; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:left; }
  th { background:#f8f8f8; }
  .level-header {
    background-color: #b91c1c;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    padding: 10px 16px;
    text-align: center;
    border-radius: 0 0 8px 8px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>
<div class="level-header">Życie codzienne – C2</div>

<h1>Test pamięci — pary PL-EN</h1>
<p class="muted">
Wpisz pary słów w formacie: <b>polskie słowo - angielskie słowo</b>.<br>
Możesz podać kilka par, oddzielając je <b>przecinkami</b> lub <b>nowymi liniami</b>.<br>
(Uwaga: <b>średnik „;”</b> w środku słowa oznacza wiele tłumaczeń – nie oddziela par!)
</p>

<textarea id="answers" placeholder="Przykład: polskie - angielskie"></textarea><br/>
<button id="checkBtn">Sprawdź</button>
<button id="clearBtn">Wyczyść</button>
<button id="hintBtn">Podpowiedź</button>
<button id="revealBtn">Pokaż prawidłową listę</button>
<div id="liveCounter" class="muted">Trafione: <span class="counter">0</span> / <span id="totalCount">0</span></div>

<div id="results"></div>

<script>
const items = [
  {en: "a pillowcase", pl: "poszewka na poduszkę"},
  {en: "to fray", pl: "strzępić (się); szarpać"},
  {en: "frayed nerves", pl: "zszarpane nerwy"},
  {en: "to soil", pl: "zabrudzić"},
  {en: "to smear", pl: "smarować; mazać"},
  {en: "a smear", pl: "plama (np. ze smaru)"},
  {en: "a funnel", pl: "lejek"},
  {en: "to ladle", pl: "nalewać chochlą"},
  {en: "a ladle", pl: "chochla"},
  {en: "a tureen", pl: "waza"},
  {en: "a soup tureen", pl: "waza na zupę"},
  {en: "a liner", pl: "wkładka (zwłaszcza ochronna)"},
  {en: "bin liners", pl: "worki na śmieci"}
];

document.getElementById('totalCount').textContent = items.length;
let matchedGlobal = new Set();
let showAll = false; // <== nowa flaga

function normalize(s){
  return s.trim().toLowerCase().replace(/[.,:()"]/g,"").normalize('NFKD').replace(/[\u0300-\u036f]/g, '');
}

function renderTable(){
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>#</th><th>Angielski</th><th>Polski</th></tr>';
  table.appendChild(thead);
  const tbody = document.createElement('tbody');
  items.forEach((it, idx) => {
    const tr = document.createElement('tr');
    if (matchedGlobal.has(idx)) {
      tr.classList.add('good');
      tr.innerHTML = `<td>${idx+1}</td><td>${it.en}</td><td>${it.pl}</td>`;
    } else if (showAll) {
      tr.classList.add('bad');
      tr.innerHTML = `<td>${idx+1}</td><td>${it.en}</td><td>${it.pl}</td>`;
    } else {
      tr.innerHTML = `<td>${idx+1}</td><td>— — —</td><td>— — —</td>`;
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  return table;
}

function autoCheck(){
  const raw = document.getElementById('answers').value;
  const entries = raw.split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);
  const matched = new Set([...matchedGlobal]);

  entries.forEach(e => {
    const parts = e.split('-');
    if (parts.length !== 2) return;
    const left = normalize(parts[0]);
    const right = normalize(parts[1]);
    items.forEach((it, idx) => {
      if (matched.has(idx)) return;
      const matchNormal = normalize(it.en) === right && normalize(it.pl) === left;
      const matchReversed = normalize(it.en) === left && normalize(it.pl) === right;
      if (matchNormal || matchReversed) {
        matched.add(idx);
      }
    });
  });

  matchedGlobal = matched;
  document.querySelector('#liveCounter .counter').textContent = matched.size;
  const results = document.getElementById('results');
  results.innerHTML = '';
  results.appendChild(renderTable());
}

function checkAnswers(){
  showAll = true; // <== dopiero teraz odsłaniamy wszystkie
  autoCheck();
}

function showHints(){
  showAll = false;
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>#</th><th>Angielski</th><th>Polski</th></tr>';
  table.appendChild(thead);
  const tbody = document.createElement('tbody');
  items.forEach((it, idx) => {
    const tr = document.createElement('tr');
    if (matchedGlobal.has(idx)) {
      tr.classList.add('good');
      tr.innerHTML = `<td>${idx+1}</td><td>${it.en}</td><td>${it.pl}</td>`;
    } else {
      tr.innerHTML = `<td>${idx+1}</td><td>— — —</td><td>${it.pl}</td>`;
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  const results = document.getElementById('results');
  results.innerHTML = '';
  results.appendChild(table);
}

document.getElementById('answers').addEventListener('input', ()=>{
  showAll = false; // podczas pisania – nie pokazuj wszystkiego
  autoCheck();
});
document.getElementById('checkBtn').addEventListener('click', checkAnswers);
document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('answers').value = '';
  matchedGlobal = new Set();
  showAll = false;
  document.querySelector('#liveCounter .counter').textContent = 0;
  document.getElementById('results').innerHTML = '';
});
document.getElementById('hintBtn').addEventListener('click', showHints);
document.getElementById('revealBtn').addEventListener('click', ()=>{
  alert(items.map((it,i)=>`${i+1}. ${it.pl} - ${it.en}`).join('\n'));
});
</script>
</body>
</html>
